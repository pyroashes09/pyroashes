<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <!-- Keep page from zooming while playing on mobile -->
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <title>pyroashes.lol</title>
    <meta name="description" content="pyroashes.lol • links and a built-in Flappy game" />
    <meta name="theme-color" content="#8b5cf6" />

    <!-- Social/SEO niceties -->
    <meta property="og:title" content="pyroashes.lol" />
    <meta property="og:description" content="Links and a built-in Flappy game." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="/og.png" />
    <meta name="twitter:card" content="summary_large_image" />
    <link rel="icon" href="/favicon.ico" />

    <style>
      :root {
        --bg:#0b0b0f; --fg:#e7e7ff; --muted:#b6b6d1;
        --accent:#8b5cf6; --accent-2:#c084fc;
        --card:linear-gradient(180deg, rgba(139,92,246,.08), rgba(139,92,246,.03));
      }
      *{ box-sizing:border-box; }
      html, body{
        margin:0; padding:0; height:100%;
        font-family:system-ui, sans-serif;
        background:var(--bg); color:var(--fg); line-height:1.5;
        overflow:hidden; /* desktop: single-screen layout */
        touch-action:manipulation; overscroll-behavior:contain;
      }
      body{ display:flex; align-items:center; justify-content:center; }
      .container{ width:90vw; height:90vh; max-width:900px; max-height:700px; display:flex; flex-direction:column; justify-content:space-between; }
      header{ display:flex; justify-content:space-between; align-items:center; }
      h1{ margin:0; font-size:1.5rem; color:var(--accent-2); }
      nav a{ color:var(--fg); margin-left:1rem; text-decoration:none; }
      a:focus-visible{ outline:2px solid var(--accent-2); outline-offset:2px; border-radius:6px; }
      .card{ background:var(--card); border:1px solid rgba(139,92,246,.18); border-radius:14px; padding:12px; flex:1; display:flex; flex-direction:column; align-items:center; justify-content:center; min-height:280px; }
      main{ display:grid; grid-template-columns:1fr 1fr; gap:16px; height:100%; }
      /* Canvas fills its card; ratio keeps layout stable */
      canvas#gameCanvas{
        width:100%; height:auto; aspect-ratio:3/4;
        border-radius:12px;
        background:linear-gradient(180deg, #151521, #0b0b0f);
        touch-action:none; /* pointer goes to game, not scroll/zoom */
      }
      footer{ text-align:center; color:var(--muted); font-size:.9rem; margin-top:8px; }

      @media (max-width: 720px){
        main{ grid-template-columns:1fr; height:auto; }
        html, body{ overflow:auto; } /* allow scroll on phones */
      }
      @media (prefers-reduced-motion: reduce){
        *{ scroll-behavior:auto; animation:none!important; transition:none!important; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header>
        <h1>pyroashes.lol</h1>
        <nav>
          <a href="#game">Game</a>
          <a href="#links">Links</a>
        </nav>
      </header>

      <main>
        <section id="game" class="card">
          <h2>flappy bird cuz why not</h2>
          <!-- aria label so SR users get instructions -->
          <canvas id="gameCanvas" role="img" aria-label="Flappy game canvas. Press Space or Arrow Up to flap."></canvas>
        </section>

        <section id="links" class="card">
          <h2>super important links :3</h2>
          <ul>
            <li><a id="discordLink" target="_blank" rel="noopener noreferrer">Discord</a></li>
            <li><a id="githubLink"  target="_blank" rel="noopener noreferrer">GitHub</a></li>
            <li><a id="steamLink"   target="_blank" rel="noopener noreferrer">Steam</a></li>
          </ul>
        </section>
      </main>

      <footer>© <span id="year"></span> pyroashes.lol</footer>
    </div>

    <script>
      // ---- Links + year ----
      const LINKS = {
        discord:'https://discord.com/users/1201937202808885320',
        github:'https://github.com/pyroashes09',
        steam:'https://steamcommunity.com/profiles/76561199470936572/'
      };
      year.textContent = new Date().getFullYear();
      discordLink.href = LINKS.discord;
      githubLink.href  = LINKS.github;
      steamLink.href   = LINKS.steam;

      // Smooth-scroll anchors even when body can't scroll
      document.querySelectorAll('nav a[href^="#"]').forEach(a => {
        a.addEventListener('click', e => {
          e.preventDefault();
          const el = document.getElementById(a.getAttribute('href').slice(1));
          el?.scrollIntoView({ behavior: 'smooth', block: 'center' });
        });
      });

      // ---- Canvas HiDPI sizing ----
      const canvas = document.getElementById('gameCanvas');
      const ctx = canvas.getContext('2d', { alpha: false });
      const dpr = Math.max(1, window.devicePixelRatio || 1);

      function sizeCanvasToCSSBox() {
        const rect = canvas.getBoundingClientRect();
        const w = Math.max(1, Math.floor(rect.width  * dpr));
        const h = Math.max(1, Math.floor(rect.height * dpr));
        if (canvas.width !== w || canvas.height !== h) {
          canvas.width = w; canvas.height = h;
          // Draw using CSS pixel coordinates:
          ctx.setTransform(dpr, 0, 0, dpr, 0, 0);
        }
      }
      sizeCanvasToCSSBox();
      addEventListener('resize', sizeCanvasToCSSBox);

      // ---- Flappy (time-based) ----
      let bird = { x:50, y:150, vy:0 };
      let pipes = [];
      let score = 0, hi = Number(localStorage.getItem('hi') || 0);
      let state = 'play'; // 'play' | 'dead'
      let last = 0, spawnTimer = 0, paused = false;

      const gravity = 0.40;   // px per 16.67ms^2
      const flap    = -7.0;   // px per 16.67ms impulse
      const gap     = 200;    // px (CSS pixels)
      const pipeW   = 60;
      const speed   = 2.0;    // px per 16.67ms
      const r       = 10;     // bird radius

      function spawnPipe(){
        const top = Math.random() * 150 + 50; // 50..200
        pipes.push({ x: canvas.width / dpr, top, bottom: top + gap, scored: false });
      }

      function reset(){
        state = 'play';
        bird = { x:50, y:150, vy:0 };
        pipes = [];
        score = 0;
        spawnTimer = 0;
      }

      function die(){
        state = 'dead';
        hi = Math.max(hi, score);
        localStorage.setItem('hi', hi);
        bird.vy = 0;
      }

      function flapBird(){
        if (state === 'dead') { reset(); }
        bird.vy = flap;
      }

      // Input: keyboard + pointer
      addEventListener('keydown', e => {
        if (e.code === 'Space' || e.code === 'ArrowUp') { e.preventDefault(); flapBird(); }
      });
      canvas.addEventListener('pointerdown', e => { e.preventDefault(); flapBird(); }, { passive:false });

      // ===== Universal zoom clamp scoped to the game canvas =====
      let zoomBlockActive = false;
      let lastTap = 0;

      function enableZoomBlockers() {
        if (zoomBlockActive) return;
        zoomBlockActive = true;

        // Ctrl/Meta + wheel (trackpad pinch on many browsers)
        enableZoomBlockers._onWheel = (e) => {
          if (!zoomBlockActive) return;
          if (e.ctrlKey || e.metaKey) e.preventDefault();
        };
        document.addEventListener('wheel', enableZoomBlockers._onWheel, { passive:false });

        // Zoom key combos
        enableZoomBlockers._onKeyDown = (e) => {
          if (!zoomBlockActive) return;
          const k = e.key;
          const zoomKeys = (k === '+' || k === '-' || k === '=' || k === '_' || k === '0');
          if ((e.ctrlKey || e.metaKey) && zoomKeys) e.preventDefault();
        };
        document.addEventListener('keydown', enableZoomBlockers._onKeyDown, { passive:false });

        // Safari/iOS gesture events
        enableZoomBlockers._onGesture = (e) => { if (zoomBlockActive) e.preventDefault(); };
        document.addEventListener('gesturestart', enableZoomBlockers._onGesture, { passive:false });
        document.addEventListener('gesturechange', enableZoomBlockers._onGesture, { passive:false });
        document.addEventListener('gestureend', enableZoomBlockers._onGesture, { passive:false });
      }

      function disableZoomBlockers() {
        if (!zoomBlockActive) return;
        zoomBlockActive = false;
        document.removeEventListener('wheel', enableZoomBlockers._onWheel);
        document.removeEventListener('keydown', enableZoomBlockers._onKeyDown);
        document.removeEventListener('gesturestart', enableZoomBlockers._onGesture);
        document.removeEventListener('gesturechange', enableZoomBlockers._onGesture);
        document.removeEventListener('gestureend', enableZoomBlockers._onGesture);
      }

      // Engage blockers while interacting with the canvas
      canvas.addEventListener('pointerdown', () => { enableZoomBlockers(); });
      canvas.addEventListener('pointerup',   () => { disableZoomBlockers(); });
      canvas.addEventListener('pointercancel', () => { disableZoomBlockers(); });
      canvas.addEventListener('pointerleave',  () => { disableZoomBlockers(); });

      // Touch: kill pinch + double-tap zoom on the canvas
      canvas.addEventListener('touchstart', (e) => {
        if (e.touches.length > 1) e.preventDefault(); // pinch start
        enableZoomBlockers();
      }, { passive:false });

      canvas.addEventListener('touchmove', (e) => {
        if (e.touches.length > 1) e.preventDefault(); // ongoing pinch
      }, { passive:false });

      canvas.addEventListener('touchend', (e) => {
        const now = performance.now();
        if (now - lastTap < 300) e.preventDefault(); // double-tap zoom
        lastTap = now;
        // release shortly after all fingers up
        if (e.touches.length === 0) setTimeout(() => { disableZoomBlockers(); }, 120);
      }, { passive:false });

      // ---- Pause when tab not focused ----
      addEventListener('blur',  () => { paused = true;  disableZoomBlockers(); });
      addEventListener('focus', () => { paused = false; last = 0; });

      function loop(t = 0){
        if (paused) { requestAnimationFrame(loop); return; }

        // dt in ms; clamp to avoid big jumps
        const dt = Math.min(48, t - (last || t)); // ~<= 3 frames worth
        last = t;
        const k = (dt || 16.67) / 16.67; // scale factor vs 60fps

        // Ensure canvas matches CSS box (and clear)
        ctx.setTransform(1,0,0,1,0,0);
        ctx.clearRect(0,0,canvas.width,canvas.height);
        ctx.setTransform(dpr,0,0,dpr,0,0);

        // Spawn pipes by elapsed time
        spawnTimer += dt || 16.67;
        if (spawnTimer >= 1500) { // every 1.5s
          spawnPipe();
          spawnTimer = 0;
        }

        // Physics
        bird.vy += gravity * k;
        bird.y  += bird.vy * k;

        // Move + draw pipes
        ctx.fillStyle = '#1c1c28';
        pipes.forEach(p => {
          p.x -= speed * k;
          // columns
          ctx.fillRect(p.x, 0, pipeW, p.top);
          ctx.fillRect(p.x, p.bottom, pipeW, canvas.height / dpr - p.bottom);

          // scoring
          if (!p.scored && p.x + pipeW < bird.x) { score++; p.scored = true; }

          // collisions
          const withinX = (bird.x + r > p.x) && (bird.x - r < p.x + pipeW);
          const hitTop  = (bird.y - r) < p.top;
          const hitBot  = (bird.y + r) > p.bottom;
          if (withinX && (hitTop || hitBot) && state === 'play') die();
        });
        // Cull off-screen
        pipes = pipes.filter(p => p.x + pipeW > 0);

        // Floor/ceiling
        const H = canvas.height / dpr;
        if ((bird.y - r < 0 || bird.y + r > H) && state === 'play') die();

        // Draw bird
        ctx.fillStyle = '#c084fc';
        ctx.beginPath(); ctx.arc(bird.x, bird.y, r, 0, Math.PI*2); ctx.fill();

        // HUD
        ctx.fillStyle = '#ffffff';
        ctx.font = '20px system-ui, sans-serif';
        ctx.fillText('Score: ' + score, 10, 25);
        ctx.fillText('Best: '  + hi,    10, 48);

        // Game over overlay
        if (state === 'dead') {
          ctx.fillStyle = 'rgba(0,0,0,.5)';
          ctx.fillRect(0,0,canvas.width/dpr, canvas.height/dpr);
          ctx.fillStyle = '#fff';
          ctx.font = '24px system-ui, sans-serif';
          ctx.fillText(`Game Over — Score ${score} • Best ${hi}`, 20, 80);
          ctx.font = '16px system-ui, sans-serif';
          ctx.fillText('Click or press Space to restart', 20, 108);
        }

        requestAnimationFrame(loop);
      }

      // Kick off
      reset();
      requestAnimationFrame(loop);
    </script>
  </body>
</html>

